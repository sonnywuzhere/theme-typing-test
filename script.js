const carsWords = [
  "Lightning",
  "McQueen",
  "Mater",
  "Sally",
  "Radiator",
  "Springs",
  "Doc",
  "Hudson",
  "Ramone",
  "Luigi",
  "Guido",
  "Fillmore",
  "Sheriff",
  "Flo",
  "Chick",
  "Hicks",
  "Rust-eze",
  "Dinoco",
  "Ka-Chow",
  "Piston",
  "Cup",
  "Route",
  "66",
  "Speed",
  "Kachigga",
  "Tow",
  "Truck",
  "Race",
  "Track",
  "Tires",
  "Pit",
  "Stop",
  "V8",
  "Cafe",
  "Bumper",
  "Paint",
  "Shop",
  "Cruise",
  "Queen",
  "Victory",
  "Lap",
  "Gas",
  "Tank",
  "Turn",
  "Left",
  "Wheels",
  "Engine",
  "Horsepower",
  "Fuel",
  "Pump",
  "Highway",
  "Sticker",
  "Hood",
  "Windshield",
  "Radiator",
  "Chassis",
  "Overdrive",
  "Drafting",
  "Crew",
  "Team",
  "Turbo",
  "Nitro",
  "Draft",
  "Overhaul",
  "Drift",
  "Grill",
  "Exhaust",
  "Trailer",
  "Trophy",
  "Fans",
  "Mechanic",
  "Oil",
  "Can",
  "Grease",
  "Trackside",
  "Lights",
  "Traffic",
  "Cone",
  "Road",
  "Pothole",
  "Racer",
  "Victory",
  "Team",
  "Sponsor",
  "Logo",
  "Finish",
  "Line",
  "Lap",
  "Leaderboard",
  "Autograph",
  "Competition",
  "Tuning",
  "Gear",
  "Transmission",
  "Cruiser",
];

const hiddenFiguresWords = [
  "Numbers",
  "Matter",
  "Figure",
  "Hidden",
  "NASA",
  "Space",
  "Math",
  "Genius",
  "Trajectory",
  "Calculate",
  "Katherine",
  "Johnson",
  "Dorothy",
  "Vaughan",
  "Mary",
  "Jackson",
  "Go",
  "No",
  "Flight",
  "Control",
  "Engineer",
  "Equal",
  "Opportunity",
  "Colored",
  "Computers",
  "Breaking",
  "Barriers",
  "Launch",
  "Freedom",
  "Equality",
  "Excellence",
  "Intelligence",
  "Rocket",
  "Orbit",
  "America",
  "Heroes",
  "Mathematician",
  "Courage",
  "Persistence",
  "Respect",
  "Change",
  "Progress",
  "Data",
  "Problem",
  "Solution",
  "Innovation",
  "Calculations",
  "Challenge",
  "History",
  "Spacecraft",
  "Mercury",
  "Friendship",
  "Astronaut",
  "Launchpad",
  "Success",
  "Determination",
  "Dream",
  "Lift",
  "Mathematics",
  "Leadership",
  "Vision",
  "Pioneers",
  "Breaking",
  "Ceilings",
  "Code",
  "IBM",
  "Programming",
  "Machines",
  "Workforce",
  "Integration",
  "Civil",
  "Rights",
  "Justice",
  "Groundbreaking",
  "Mission",
  "Impact",
  "Excellence",
  "Possibility",
  "Believe",
  "Legacy",
  "Representation",
  "Empowerment",
  "Strategy",
  "Leadership",
  "Drive",
  "Proof",
  "Potential",
  "Effort",
  "Flightpath",
  "Discover",
  "Achievement",
  "Significance",
  "Role",
  "Strength",
  "Innovation",
  "Visionary",
];

const princessSwitchWords = [
  "Vanessa",
  "Hudgens",
  "Stacy",
  "Margaret",
  "Kevin",
  "Olivia",
  "Prince",
  "Edward",
  "Montenaro",
  "Belgravia",
  "Switched",
  "Twins",
  "Baker",
  "Royal",
  "Ball",
  "Castle",
  "Christmas",
  "Duchess",
  "Lookalike",
  "Friendship",
  "Romance",
  "Cookies",
  "Tradition",
  "Snow",
  "Decorations",
  "Bakery",
  "Switch",
  "Love",
  "Holiday",
  "Competition",
  "Affection",
  "Engagement",
  "Heirloom",
  "Tree",
  "Lights",
  "Family",
  "Destiny",
  "Crown",
  "Pastry",
  "Montague",
  "Festival",
  "Contest",
  "Connection",
  "Teamwork",
  "Identity",
  "Surprise",
  "Adventure",
  "Magic",
  "Double",
  "Christmas Eve",
  "Scepter",
  "Proposal",
  "Secret",
  "Charm",
  "Empathy",
  "Accident",
  "Discovery",
  "Disguise",
  "Tiara",
  "Traditions",
  "Santa",
  "Ice",
  "Skating",
  "Chocolate",
  "Charity",
  "Party",
  "Celebration",
  "King",
  "Queen",
  "Preparation",
  "Compassion",
  "Mistake",
  "Mission",
  "Kindness",
  "Gala",
  "Truth",
  "Promise",
  "Betrayal",
  "Baking",
  "Decorating",
  "Miracle",
  "Ornaments",
  "Wedding",
  "Pretend",
  "Dreams",
  "Trust",
  "Generosity",
  "Village",
  "Harmony",
  "Royalty",
  "Wonder",
  "Aspiration",
  "Festival",
  "Home",
  "Journey",
  "Tradition",
  "Hope",
  "Togetherness",
];

const anneOfGreenGablesWords = [
  "Anne",
  "Shirley",
  "Green",
  "Gables",
  "Avonlea",
  "Prince",
  "Edward",
  "Island",
  "Matthew",
  "Cuthbert",
  "Marilla",
  "Imagination",
  "Kindred",
  "Spirit",
  "Diana",
  "Barry",
  "Gilbert",
  "Blythe",
  "Rachel",
  "Lynde",
  "School",
  "Red",
  "Hair",
  "Carrots",
  "Lake",
  "Shining",
  "Waters",
  "Poetry",
  "Dreams",
  "Ambition",
  "Orphan",
  "Adoption",
  "Kindness",
  "Friendship",
  "Books",
  "Slate",
  "Apology",
  "House",
  "White",
  "Way",
  "Violet",
  "Pasture",
  "Courage",
  "Heart",
  "Teacher",
  "Mistakes",
  "Love",
  "Garden",
  "Raspberry",
  "Cordial",
  "Snow",
  "Adventure",
  "Romance",
  "Tragedy",
  "Horizon",
  "Kindness",
  "Education",
  "Nature",
  "Spring",
  "Blossom",
  "Church",
  "Village",
  "Family",
  "Grief",
  "Forgiveness",
  "Companionship",
  "Ambition",
  "Storytelling",
  "Growth",
  "Summer",
  "Autumn",
  "Winter",
  "Barn",
  "Farm",
  "Beauty",
  "Inspiration",
  "Hope",
  "Joy",
  "Compassion",
  "Determination",
  "Courage",
  "Misunderstanding",
  "Apology",
  "Reconciliation",
  "Lessons",
  "Youth",
  "Whimsy",
  "Creativity",
  "Trouble",
  "Adventure",
  "Belonging",
  "Acceptance",
  "Pride",
  "Struggle",
  "Destiny",
  "Fate",
  "Legacy",
];

const codingWords = [
  "Algorithm",
  "Function",
  "Variable",
  "Loop",
  "Array",
  "Object",
  "Class",
  "Method",
  "Inheritance",
  "Polymorphism",
  "Encapsulation",
  "Abstraction",
  "Recursion",
  "Debugging",
  "Compiler",
  "Interpreter",
  "Syntax",
  "Semantics",
  "Framework",
  "Library",
  "Package",
  "Dependency",
  "Module",
  "API",
  "Endpoint",
  "Database",
  "Query",
  "SQL",
  "NoSQL",
  "JSON",
  "XML",
  "HTTP",
  "HTTPS",
  "Frontend",
  "Backend",
  "Fullstack",
  "JavaScript",
  "Python",
  "Java",
  "C++",
  "C#",
  "Ruby",
  "Swift",
  "Kotlin",
  "HTML",
  "CSS",
  "TypeScript",
  "Node.js",
  "React",
  "Vue",
  "Angular",
  "Bootstrap",
  "Tailwind",
  "REST",
  "GraphQL",
  "DevOps",
  "CI/CD",
  "Docker",
  "Kubernetes",
  "Cloud",
  "AWS",
  "Azure",
  "GCP",
  "Serverless",
  "Version",
  "Git",
  "GitHub",
  "Bitbucket",
  "Testing",
  "Unit",
  "Integration",
  "Mocking",
  "Debugger",
  "IDE",
  "Text",
  "Editor",
  "Terminal",
  "Shell",
  "Script",
  "Regex",
  "Hashing",
  "Encryption",
  "Blockchain",
  "Data",
  "Structure",
  "Algorithm",
  "Sorting",
  "Binary",
  "Tree",
  "Linked",
  "List",
  "Stack",
  "Queue",
  "Big-O",
  "Complexity",
  "AI",
  "Machine",
  "Learning",
  "TensorFlow",
  "PyTorch",
];

const highSchoolMusicalWords = [
  "Troy",
  "Gabriella",
  "Sharpay",
  "Ryan",
  "Chad",
  "Taylor",
  "MsDarbus",
  "EastHigh",
  "basketball",
  "Wildcats",
  "decathlon",
  "audition",
  "callback",
  "BreakingFree",
  "StartOfSomethingNew",
  "WhatIveBeenLookingFor",
  "BopToTheTop",
  "WeAreAllInThisTogether",
  "karaoke",
  "NewYearsEve",
  "teamwork",
  "singing",
  "friendship",
  "dreams",
  "talent",
  "competition",
  "drama",
  "coach",
  "game",
  "performance",
  "musical",
  "chemistry",
  "dedication",
  "hope",
  "rehearsal",
  "trust",
  "courage",
  "growth",
  "love",
  "jealousy",
  "team",
  "squad",
  "confidence",
  "loyalty",
  "school",
  "stage",
  "gym",
  "theater",
  "playmaker",
  "relationship",
  "support",
  "harmony",
  "practices",
  "determination",
  "success",
  "goals",
  "mentor",
  "respect",
  "basket",
  "coachBolton",
  "DarbusRules",
  "SharpayRules",
  "dance",
  "creativity",
  "leadership",
  "collaboration",
  "acting",
  "express",
  "identity",
  "sportsmanship",
  "music",
  "bond",
  "acceptance",
  "change",
  "highschool",
  "achieve",
  "unique",
  "aspiration",
  "guidance",
  "effort",
  "kindness",
  "strategy",
  "hopeful",
  "positivity",
  "dedication",
  "schoolspirit",
  "honesty",
  "challenge",
  "comeback",
  "celebration",
  "growth",
  "audience",
  "balance",
  "resolve",
  "determined",
  "goals",
  "dream",
  "lead",
];

const themes = {
  "Cars 3": ["Cars 3", carsWords],
  "Hidden Figures": ["Hidden Figures", hiddenFiguresWords],
  "Princess Switch": ["Princess Switch", princessSwitchWords],
  "Anne of Green Gables": ["Anne of Green Gables", anneOfGreenGablesWords],
  "High School Musical": ["High School Musical", highSchoolMusicalWords],
  Coding: ["Coding", codingWords],
};

const textContainer = document.getElementById("text-container");
const timerElement = document.getElementById("timer");
const tryAgainButton = document.getElementById("try-again");
const finalScoreElement = document.getElementById("final-score");
const header = document.getElementById("heading-text");
const tagline = document.getElementById("tagline");
const theme = document.getElementById("choose-word-theme");

let wordsChosen = ["It was the best of times, it was the worst of times"];

for (t in themes) {
  let showTheme = document.createElement("div");
  showTheme.id = t.toLowerCase().split(" ").join("-");
  showTheme.textContent = t;
  showTheme.style.padding = "10px";
  showTheme.style.cursor = "pointer";
  showTheme.addEventListener("mouseover", () => {
    showTheme.style.backgroundColor = "lightGrey";
  });
  showTheme.addEventListener("mouseout", () => {
    showTheme.style.backgroundColor = "";
  });
  showTheme.addEventListener("click", (e) => {
    let themeChosen = showTheme.textContent;
    wordsChosen = themes[themeChosen][1];
    resetTest();
  });
  theme.appendChild(showTheme);
}

let totalTyped = "";
let currentCharIndex = 0;
let errors = 0;
let longText = generateLongText(wordsChosen);
let timeLeft = 60;
let timerInterval;
let typingStarted = false;
let level = 1;

// Shuffle the words array
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// Combine shuffled words into one long string with spaces
function generateLongText(words) {
  const shuffledWords = shuffleArray([...words]);
  return shuffledWords.join(" ");
}

// Start countdown timer
function startTimer() {
  if (!typingStarted) {
    typingStarted = true;
    timerInterval = setInterval(() => {
      timeLeft--;
      timerElement.textContent = `Time left: ${timeLeft}`;
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        endTest();
      }
    }, 1000);
  }
}

// End the test and display the final score
function endTest() {
  timerElement.textContent = `Time's up!`;
  finalScoreElement.textContent = `Final WPM: ${calculateWPM()}`;
  textContainer.style.display = "none";
  tryAgainButton.style.display = "block";
  header.style.display = "none";
  tagline.style.display = "none";
}

// Calculate words-per-minute with error adjustment
function calculateWPM() {
  const wordsTyped = totalTyped.trim().split(/\s+/).length;
  const baseWPM = Math.round(wordsTyped / 60);
  const adjustedWPM = Math.max(baseWPM - errors, 0);
  return adjustedWPM;
}

// Handle typing over the displayed text and scrolling
document.addEventListener("keydown", (e) => {
  startTimer();

  if (e.key === "Backspace") {
    if (totalTyped.length > 0) {
      currentCharIndex = Math.max(currentCharIndex - 1, 0);
      totalTyped = totalTyped.slice(0, -1);
      errors++;
    }
  } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {
    totalTyped += e.key;
    currentCharIndex++;
  }

  const textArray = longText.split("");
  textContainer.innerText = "";

  errors = 0;

  for (let i = 0; i < textArray.length; i++) {
    const span = document.createElement("span");

    if (i < totalTyped.length) {
      if (totalTyped[i] === textArray[i]) {
        span.classList.add("correct");
      } else {
        span.classList.add("error");
        errors++;
      }
    }
    span.textContent = textArray[i];
    textContainer.appendChild(span);
  }

  // Scroll the container only after 20 characters
  if (totalTyped.length >= 20) {
    const scrollAmount = (totalTyped.length - 40) * 7;
    textContainer.scrollLeft = scrollAmount;
  }
});

// Reset the test
function resetTest() {
  clearInterval(timerInterval);
  timeLeft = 60;
  timerElement.textContent = `Time left: ${timeLeft}s`;
  finalScoreElement.textContent = "";
  textContainer.style.display = "block";
  tryAgainButton.style.display = "none";
  header.style.display = "block";
  totalTyped = "";
  typingStarted = false;
  currentCharIndex = 0;
  errors = 0;
  textContainer.scrollLeft = 0;
  longText = generateLongText(wordsChosen);
  init();
}

// Initialize the test
function init() {
  if (isMobileDevice()) {
    showMobileMessage();
  } else {
    textContainer.innerText = longText;
    timerElement.textContent = `Time left: ${timeLeft}s`;
  }
}

// Try again button listener
tryAgainButton.addEventListener("click", (e) => {
  resetTest();
  level++;
  console.log(level);
});

// Detect if the device is mobile
function isMobileDevice() {
  return /Mobi|Android/i.test(navigator.userAgent) || window.innerWidth < 800;
}

// Show message for mobile users
function showMobileMessage() {
  textContainer.textContent =
    "This typing test is designed for desktop use only";
}

// Startup
init();

// Features to add
//
// Can choose the "theme" of the word list
// Have chatGPT generate an array based on what the user inputs??
//
// LEVELS
// Level 0 -> Standard words
// Level 1 -> flip the colors (turns red when correct, and green when incorrect)
// Level 2 -> flip the colors back, but have the background be a moving background
// Level 3 ->
